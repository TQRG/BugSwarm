<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:fmt="http://java.sun.com/jsp/jstl/fmt">

    <div class="widget forumAreasWidget">
      <div class="forumAreaList">
        <c:forEach var="forum" items="#{forumAreas}">
          <div class="forumAreaLink">
            <a href="#{request.contextPath}/forum/threads.jsf?area=#{forum.id}">#{forum.name}</a>

            <c:set var="lastMessage" value="#{Forum.getLatestMessage(forum)}" />
            
            <c:choose>
              <c:when test="#{not empty lastMessage}">
                <c:set var="replyUserEntity" value="#{Forum.findUserEntity(lastMessage.creator)}" />
                <c:set var="replyUser" value="#{Forum.findUser(replyUserEntity)}" />
              </c:when>
              <c:otherwise>
                <c:set var="replyUserEntity" value="#{null}" />
                <c:set var="replyUser" value="#{null}" />
              </c:otherwise>
            </c:choose>

            <span>
              <c:choose>
                <c:when test="#{lastMessage['class'].simpleName == 'ForumThread'}">#{lastMessage.title}</c:when>
                <c:when test="#{lastMessage['class'].simpleName == 'ForumThreadReply'}">#{lastMessage.thread.title}</c:when>
              </c:choose>
            </span>
            <span>#{replyUser.firstName} #{replyUser.lastName}</span>
            <span>
              <h:outputText value="#{lastMessage.created}">
                <f:convertDateTime type="both" dateStyle="short" />
              </h:outputText>
            </span>

            <span>Ketjujen määrä: #{Forum.getThreadCount(forum)}</span>
            <span>Postien määrä: #{Forum.getMessageCount(forum)}</span>
<!--             <span>Lukukertojen määrä</span> -->
          </div>
        </c:forEach>
      </div>
    </div>
    
</ui:composition>
