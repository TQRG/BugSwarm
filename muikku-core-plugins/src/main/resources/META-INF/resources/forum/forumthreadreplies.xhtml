<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:fmt="http://java.sun.com/jsp/jstl/fmt">

    <div class="widget forumThreadsWidget">
      <div class="forumThreadBody">
        <div class="forumThreadUserImageContainer">
          <c:set var="threadPersonEntity" value="#{Forum.findUserEntity(thread.creator)}" />
          <c:set var="threadUser" value="#{Forum.findUser(threadPersonEntity)}" />

          <c:choose>
            <c:when test="#{Forum.getUserHasPicture(threadPersonEntity)}">
              <img class="cm-user-picture custom" src="#{request.contextPath}/picture?userId=#{thread.creator}" width="50" height="50" />
            </c:when>
            <c:otherwise>
              <div class="cm-user-picture default"></div>
            </c:otherwise>
          </c:choose>
        </div>

        <div class="forumThreadStarter">
          #{threadUser.firstName} #{threadUser.lastName} 
          
          <h:outputText value="#{thread.created}">
            <f:convertDateTime type="both" dateStyle="short" />
          </h:outputText>
        </div>

        <div class="forumThreadTitle">
          #{thread.title}
        </div>
        <div class="forumThreadMessage">
          #{thread.message}
        </div>
      </div>
    
      <div class="forumThreadReplyList">
        <c:forEach var="reply" items="#{Forum.listForumThreadReplies(thread)}">
          <c:set var="replyPersonEntity" value="#{Forum.findUserEntity(reply.creator)}" />
          <c:set var="replyUser" value="#{Forum.findUser(replyPersonEntity)}" />
        
          <div class="forumThreadReplyBody">
            <div class="forumThreadReplyUserImageContainer">
              <c:choose>
                <c:when test="#{Forum.getUserHasPicture(replyPersonEntity)}">
                  <img class="cm-user-picture custom" src="#{request.contextPath}/picture?userId=#{reply.creator}" width="50" height="50" />
                </c:when>
                <c:otherwise>
                  <div class="cm-user-picture default"></div>
                </c:otherwise>
              </c:choose>
            </div>

            <div class="forumThreadReplier">
              #{replyUser.firstName} #{replyUser.lastName} 
              
              <h:outputText value="#{reply.created}">
                <f:convertDateTime type="both" dateStyle="short" />
              </h:outputText>
            </div>
            
            <div class="forumThreadReplyMessage">
              #{reply.message}
            </div>
          </div>
        </c:forEach>
      </div>
    </div>
    
</ui:composition>
