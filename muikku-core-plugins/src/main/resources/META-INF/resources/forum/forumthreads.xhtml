<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:fmt="http://java.sun.com/jsp/jstl/fmt">

    <div class="widget forumThreadsWidget">
      <div class="forumThreadList">
        <c:forEach var="thread" items="#{Forum.listForumThreads(forumArea, 0, 10)}">
          <c:set var="threadUserEntity" value="#{Forum.findUserEntity(thread.creator)}" />
          <c:set var="threadUser" value="#{Forum.findUser(threadUserEntity)}" />
        
          <c:set var="lastReply" value="#{Forum.getLatestReply(thread)}" />
          <c:choose>
            <c:when test="#{not empty lastReply}">
              <c:set var="replyUserEntity" value="#{Forum.findUserEntity(lastReply.creator)}" />
              <c:set var="replyUser" value="#{Forum.findUser(replyUserEntity)}" />
            </c:when>
            <c:otherwise>
              <c:set var="replyUserEntity" value="#{null}" />
              <c:set var="replyUser" value="#{null}" />
            </c:otherwise>
          </c:choose>

          <div class="forumThreadLink">
            <a href="#{request.contextPath}/forum/thread.jsf?thread=#{thread.id}">
              <c:if test="#{thread.sticky}">Liimainen: </c:if>
              #{thread.title}
            </a>
            
            <span>#{threadUser.firstName} #{threadUser.lastName}</span>
            <span>
              <h:outputText value="#{thread.created}">
                <f:convertDateTime type="both" dateStyle="short" />
              </h:outputText>
            </span>

            <span>#{replyUser.firstName} #{replyUser.lastName}</span>
            <span>
              <h:outputText value="#{lastReply.created}">
                <f:convertDateTime type="both" dateStyle="short" />
              </h:outputText>
            </span>

            <span>Viestien määrä: #{Forum.getThreadReplyCount(thread)}</span>
<!--             <span>Lukukertojen määrä</span> -->
<!--             <span>Sivutus</span> -->
<!--             <span>Starraus</span> -->
            
          </div>
        </c:forEach>
      </div>
    </div>
    
</ui:composition>
